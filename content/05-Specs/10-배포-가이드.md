# LifeSpeech 배포 가이드

#deployment #operations #lifespeech

**용도:** 실제 운영 배포 시 참고. 개발 완료 후 상세 작성.

---

## 1. 사전 준비

| 순서  | 작업                              | 담당  |
| --- | ------------------------------- | --- |
| 1   | 도메인 구매 (lifespeech.kr 등)        | 발주사 |
| 2   | Vercel, Railway, Supabase 계정 생성 | 개발  |
| 3   | GitHub 저장소, 브랜치 전략              | 개발  |
| 4   | 앱 스토어 개발자 계정 (앱 배포 시)           | 발주사 |

---

## 2. 환경변수 (시크릿)

| 변수명 | 용도 | 예시 |
|--------|------|------|
| DATABASE_URL | Supabase 연결 | postgresql://... |
| JWT_SECRET | 인증 토큰 | (32자 이상 랜덤) |
| SMS_API_KEY | 문자 발송 | 알리고 등 |
| MODUSIGN_API_KEY | 전자계약 | 모두싸인 |
| GOOGLE_CALENDAR_CREDENTIALS | 구글 캘린더 | JSON |
| NAVER_RESERVATION_* | 네이버 예약 (확인 후) | - |

---

## 3. 배포 순서

1. Supabase: 프로젝트 생성, DB 스키마 마이그레이션, Storage 버킷 생성
2. Railway: API 서버 배포, 환경변수 등록, 도메인 연결
3. Vercel: 관리자 웹 배포, API URL 환경변수, 도메인 연결
4. DNS: admin, api 서브도메인 CNAME 설정
5. SSL: 자동 (Vercel, Railway 기본 제공)
6. 앱: 빌드 → 스토어 제출 → 심사

---

## 4. 복구 절차

| 상황 | 절차 |
|------|------|
| API 다운 | Railway 대시보드에서 재시작, 로그 확인 |
| DB 복구 | Supabase 백업에서 Point-in-time 복구 |
| 잘못된 배포 | Git revert 후 재배포, 또는 Vercel/Railway 이전 버전 롤백 |
| 도메인 이전 | DNS 전파 대기 (최대 48시간) |

---

## 5. 정기 점검

| 주기 | 작업 |
|------|------|
| 일 | 업타임 모니터링, 에러 로그 확인 |
| 주 | 의존성 업데이트 (`npm audit`), 보안 패치 |
| 월 | DB 백업 수동 다운로드, 비용 확인 |
| 분기 | 비밀키 로테이션 검토 |

---

## 6. 장기 운영·안정성 체크리스트

*"계속 이용할 수 있을 정도로" 운영되기 위한 필수 조건*

### 6.1 인프라 (권장 플랜)

| 서비스 | 권장 | 이유 |
|--------|------|------|
| Railway | 유료 플랜 | 무료 티어 슬립·제한 없이 24/7 가동 |
| Supabase | Pro 이상 | 일일 자동 백업 7일 보관, Point-in-time 복구 |
| Vercel | Free 또는 Pro | 관리자 웹은 무료로도 충분. 트래픽 많으면 Pro |

### 6.2 사전 설정

- [ ] **비용 알림** — Railway, Supabase, Vercel 대시보드에서 예산/사용량 알림 설정
- [ ] **업타임 모니터링** — UptimeRobot 등으로 API·웹 URL 감시 (5분 간격)
- [ ] **에러 로그** — Sentry(무료 티어) 연동 또는 Railway 로그 수집
- [ ] **운영 담당 지정** — 장애 시 연락처·대응 절차 문서화

### 6.3 정기 유지보수

| 주기 | 작업 |
|------|------|
| 주 | `npm audit fix`, 의존성 패치 |
| 월 | DB 수동 백업 다운로드, 비용·Storage 용량 확인 |
| 분기 | JWT·API 키 로테이션 검토, 플랜 업그레이드 검토 |
| 반기 | 마이그레이션·롤백 절차 리허설 |

### 6.4 Storage·비용 정책

| 항목 | 권장 |
|------|------|
| 회원당 파일 용량 | 상한 설정 (예: 500MB) |
| 보관 기간 | 90일 지난 파일 아카이브 또는 삭제 정책 |
| 용량 모니터링 | Supabase Storage 대시보드 월 1회 확인 |

### 6.5 장애 대응 연락처

| 담당 | 역할 | 연락처 |
|------|------|--------|
| (발주사) | 최종 의사결정 | |
| (개발) | 기술 대응, 재시작·복구 | |
| (운영) | 일상 모니터링 | |

*실운영 전 위 표 작성 후 [[08-개발명세서#6.8 장애 대응]] 절차와 연동*

---

*[[08-개발명세서#6. 배포 및 운영 인프라]] 참고*
