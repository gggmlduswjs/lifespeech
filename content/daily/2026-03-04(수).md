---
date: 2026-03-04
week: 2ì£¼ì°¨
phase: ë°±ì—”ë“œ ì™„ì„±
tags: [lifespeech, planner, dev]
---

# 2026-03-04 (ìˆ˜) â€” 2ì£¼ì°¨ D3

> **ê·¼ë¬´:** 10:00 ~ 19:00 Â· ì‹¤ ì‘ì—… **8ì‹œê°„**
> **ëª©í‘œ:** íŒŒì¼ ì—…ë¡œë“œ (Supabase Storage) + SMS (ì•Œë¦¬ê³ ) API

---

## ì‹œê°„ ë¸”ë¡

| ì‹œê°„ | ì‘ì—… | ì˜ˆìƒ | ì™„ë£Œ ê¸°ì¤€ |
|------|------|------|-----------|
| 10:00â€“11:00 | Supabase Storage ë²„í‚· ìƒì„± + RLS ì„¤ì • | 1h | ë²„í‚· ì¡´ì¬ + ì •ì±… ì„¤ì • í™•ì¸ |
| 11:00â€“12:00 | POST /files/upload (multipart â†’ Storage) | 1h | ì—…ë¡œë“œ â†’ Storageì— íŒŒì¼ í™•ì¸ |
| 12:00â€“13:00 | ğŸ½ï¸ ì ì‹¬ | | |
| 13:00â€“14:00 | GET /files + GET /files/:id/download (Signed URL) | 1h | Signed URL ë¸Œë¼ìš°ì € ì ‘ê·¼ í™•ì¸ |
| 14:00â€“15:00 | DELETE /files/:id (Storage + DB ë™ì‹œ ì‚­ì œ) | 1h | ì‚­ì œ í›„ Storageì—ì„œ ì—†ìŒ í™•ì¸ |
| 15:00â€“16:30 | ì•Œë¦¬ê³  SMS API ì—°ë™ | 1.5h | í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë°œì†¡ ì„±ê³µ |
| 16:30â€“17:30 | ì•Œë¦¬ê³  ë°œì‹ ë²ˆí˜¸ í™•ì¸ + ì‹¤ì œ ë°œì†¡ í…ŒìŠ¤íŠ¸ | 1h | ì‹¤ì œ ë¬¸ì ìˆ˜ì‹  í™•ì¸ |
| 17:30â€“18:30 | GET /sms/templates ì—”ë“œí¬ì¸íŠ¸ | 1h | |
| 18:30â€“19:00 | GitHub ì»¤ë°‹ | 0.5h | |

---

## ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

### íŒŒì¼ ì—…ë¡œë“œ (Supabase Storage)
- [ ] Storage ë²„í‚· ìƒì„±: `lifespeech-files` (private)
- [ ] RLS: service_roleë§Œ ì ‘ê·¼ í—ˆìš©
- [ ] `POST /files/upload` (multipart â†’ Storage ì €ì¥)
  - ê²½ë¡œ: `members/{member_id}/session_{n}/{filename}`
  - ì™„ë£Œ ê¸°ì¤€: ì—…ë¡œë“œ â†’ Storage ë¸Œë¼ìš°ì €ì—ì„œ íŒŒì¼ í™•ì¸
- [ ] `GET /files` â€” member_id, enrollment_id í•„í„°
- [ ] `GET /files/:id/download` â€” Signed URL 1ì‹œê°„ ìœ íš¨
- [ ] `DELETE /files/:id` â€” Storage + DB ë™ì‹œ ì‚­ì œ

### SMS (ì•Œë¦¬ê³ )
- [ ] ì•Œë¦¬ê³  ë°œì‹ ë²ˆí˜¸ ì‹¬ì‚¬ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
- [ ] `POST /sms/send` (testmode_yn=Yë¡œ í…ŒìŠ¤íŠ¸ ë¨¼ì €)
  - ì™„ë£Œ ê¸°ì¤€: í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë°œì†¡ ì„±ê³µ ì‘ë‹µ
- [ ] `GET /sms/templates` â€” í…œí”Œë¦¿ ëª©ë¡

```
Supabase Storage êµ¬ì¡°:
lifespeech-files/
  members/{member_id}/
    session_1/homework_YYYYMMDD.mp4
    portfolio/before.mp4, after.mp4
```

---

## ğŸ¤– Claude ê°œë°œ ìš”ì²­ ìˆœì„œ

### ìš”ì²­ 1 â€” Supabase Storage íŒŒì¼ ì—…ë¡œë“œ API
```
Supabase Storage íŒŒì¼ ì—…ë¡œë“œ APIë¥¼ ë§Œë“¤ì–´ì¤˜. src/routes/files.ts

1. POST /files/upload
   - multipart/form-data: file (íŒŒì¼), member_id, enrollment_id?, session_number?
   - Storage ê²½ë¡œ: members/{member_id}/session_{session_number}/{timestamp}_{filename}
   - Supabase storage.from('lifespeech-files').upload(path, fileBuffer)
   - files í…Œì´ë¸”ì— ë©”íƒ€ë°ì´í„° INSERT
   - ì‘ë‹µ: 201 { id, file_url, file_name }

2. GET /files
   - query: member_id, enrollment_id
   - files í…Œì´ë¸”ì—ì„œ ì¡°íšŒ

3. GET /files/:id/download
   - Signed URL ìƒì„± (ìœ íš¨ì‹œê°„ 1ì‹œê°„)
   - Supabase storage.from('lifespeech-files').createSignedUrl(path, 3600)
   - ì‘ë‹µ: { signed_url }

4. DELETE /files/:id
   - Storageì—ì„œ ì‹¤ì œ íŒŒì¼ ì‚­ì œ + files í…Œì´ë¸” DELETE

requireRole('admin', 'instructor', 'member') ì ìš©.
```

### ìš”ì²­ 2 â€” ì•Œë¦¬ê³  SMS API
```
ì•Œë¦¬ê³  SMS ë°œì†¡ APIë¥¼ ë§Œë“¤ì–´ì¤˜. src/routes/sms.ts

1. POST /sms/send
   - body: { receivers: [{phone, name}], content, title? }
   - ì•Œë¦¬ê³  API í˜¸ì¶œ: https://apis.aligo.in/send/
   - íŒŒë¼ë¯¸í„°: key, user_id, sender(ë°œì‹ ë²ˆí˜¸), receiver, msg, testmode_yn
   - testmode_yn: í™˜ê²½ë³€ìˆ˜ SMS_TEST_MODE (Y=í…ŒìŠ¤íŠ¸, N=ì‹¤ì œë°œì†¡)
   - ì‘ë‹µ: { success, result_code, message }

2. GET /sms/templates
   - í•˜ë“œì½”ë”© or DBì—ì„œ ì¡°íšŒ
   - ì˜ˆì•½í™•ì¸, ìˆ˜ì—…ì•ˆë‚´, ì¶œì„í™•ì¸ ë“± í…œí”Œë¦¿ ëª©ë¡

í™˜ê²½ë³€ìˆ˜: ALIGO_API_KEY, ALIGO_USER_ID, ALIGO_SENDER, SMS_TEST_MODE
íŒ¨í‚¤ì§€: axios
```

---

## âœ… ì˜¤ëŠ˜ ë‚´ê°€ ì§ì ‘ í™•ì¸í•  ê²ƒ

**Supabase Storage í™•ì¸ (ë¸Œë¼ìš°ì €)**
- [ ] `supabase.com` â†’ í”„ë¡œì íŠ¸ â†’ **Storage** â†’ `lifespeech-files` ë²„í‚· ì¡´ì¬ í™•ì¸
- [ ] Postman â†’ `POST {API}/files/upload` â†’ form-data íŒŒì¼ ì„ íƒ â†’ ì „ì†¡
  â†’ ì‘ë‹µ: `{ "id": "...", "file_url": "..." }` í™•ì¸
- [ ] Storage ë¸Œë¼ìš°ì € â†’ members í´ë” â†’ íŒŒì¼ ì¡´ì¬ í™•ì¸

**Signed URL í™•ì¸**
- [ ] `GET {API}/files/{ID}/download` â†’ `{ "signed_url": "https://..." }` í™•ì¸
- [ ] signed_urlì„ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ê¸° â†’ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í™•ì¸

**ì•Œë¦¬ê³  SMS í…ŒìŠ¤íŠ¸**
- [ ] `aligo.co.kr` ëŒ€ì‹œë³´ë“œ â†’ ë°œì‹ ë²ˆí˜¸ ë“±ë¡ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
- [ ] Postman â†’ `POST {API}/sms/send` body: `{ "receivers": [{"phone": "ë‚´ë²ˆí˜¸", "name": "ë‚˜"}], "content": "í…ŒìŠ¤íŠ¸ ë¬¸ì" }`
  - í…ŒìŠ¤íŠ¸ ëª¨ë“œ(testmode_yn=Y): ì‘ë‹µì— result_code 1 í™•ì¸
  - **ì‹¤ì œ ë°œì†¡**: testmode_yn=Nìœ¼ë¡œ ë³€ê²½ â†’ ë‚´ í°ì—ì„œ ë¬¸ì ìˆ˜ì‹  í™•ì¸

**âŒ ë§‰í˜”ì„ ë•Œ**
- Storage ì—…ë¡œë“œ ì‹¤íŒ¨ â†’ Supabase Storage RLS ì •ì±… í™•ì¸ â†’ Claudeì—ê²Œ ì •ì±… ìˆ˜ì • ìš”ì²­
- SMS ë°œì†¡ ì‹¤íŒ¨ â†’ ì•Œë¦¬ê³  ë°œì‹ ë²ˆí˜¸ ë“±ë¡ ì™„ë£Œ ì—¬ë¶€ í™•ì¸, API Key ì¬í™•ì¸

---

## ì‘ì—… ë¡œê·¸

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ë¹„ê³  |
|------|-----------|------|
| 10:00 | | |
| 10:30 | | |
| 11:00 | | |
| 11:30 | | |
| 13:00 | | |
| 13:30 | | |
| 14:00 | | |
| 14:30 | | |
| 15:00 | | |
| 15:30 | | |
| 16:00 | | |
| 16:30 | | |
| 17:00 | | |
| 17:30 | | |
| 18:00 | | |
| 18:30 | | |

---

## ë©”ëª¨ / ì´ìŠˆ

- ì•Œë¦¬ê³  ë°œì‹ ë²ˆí˜¸ ì‹¬ì‚¬ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
