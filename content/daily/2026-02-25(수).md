---
date: 2026-02-25
week: 1ì£¼ì°¨
phase: í™˜ê²½ êµ¬ì¶•
tags: [lifespeech, planner, dev]
---

# 2026-02-25 (ìˆ˜) â€” 1ì£¼ì°¨ D3

> **ê·¼ë¬´:** 10:00 ~ 19:00 Â· ì‹¤ ì‘ì—… **8ì‹œê°„**
> **ëª©í‘œ:** JWT ì¸ì¦ ì‹œìŠ¤í…œ + ì—­í•  ë¯¸ë“¤ì›¨ì–´ (9ê°œ ì‹œë‚˜ë¦¬ì˜¤ ì „ë¶€ í†µê³¼)

---

## ì‹œê°„ ë¸”ë¡

| ì‹œê°„ | ì‘ì—… | ì˜ˆìƒ | ì™„ë£Œ ê¸°ì¤€ |
|------|------|------|-----------|
| 10:00â€“11:30 | POST /auth/login (bcrypt + JWT ë°œê¸‰) | 1.5h | ê´€ë¦¬ì ë¡œê·¸ì¸ â†’ í† í° ë°œê¸‰ |
| 11:30â€“12:00 | POST /auth/logout + GET /auth/me | 0.5h | me â†’ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜ |
| 12:00â€“13:00 | ğŸ½ï¸ ì ì‹¬ | | |
| 13:00â€“14:00 | POST /auth/refresh (RT â†’ ìƒˆ í† í°) | 1h | ë§Œë£Œ RT â†’ 401 |
| 14:00â€“15:30 | requireRole ë¯¸ë“¤ì›¨ì–´ | 1.5h | member â†’ admin ë¼ìš°íŠ¸ 403 |
| 15:30â€“17:00 | Postman 9ê°œ ì‹œë‚˜ë¦¬ì˜¤ ì „ë¶€ í…ŒìŠ¤íŠ¸ | 1.5h | ì „ë¶€ í†µê³¼ âœ… |
| 17:00â€“18:30 | users í…Œì´ë¸” + ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ì‹œë“œ | 1.5h | 3ê³„ì • ë¡œê·¸ì¸ ê°€ëŠ¥ |
| 18:30â€“19:00 | GitHub ì»¤ë°‹ | 0.5h | auth ë¸Œëœì¹˜ push |

---

## ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `POST /auth/login` â€” bcrypt ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ â†’ JWT ë°œê¸‰
  - Access Token: 15ë¶„, Refresh Token: 7ì¼
  - ì™„ë£Œ ê¸°ì¤€: ì˜¬ë°”ë¥¸ ê³„ì • â†’ accessToken + refreshToken
- [ ] `POST /auth/logout` â€” Refresh Token ë¬´íš¨í™” (DB blacklist)
- [ ] `GET /auth/me` â€” í† í° ê²€ì¦ â†’ ì‚¬ìš©ì ì •ë³´
  - ì™„ë£Œ ê¸°ì¤€: ìœ íš¨ í† í° â†’ 200, ë§Œë£Œ â†’ 401
- [ ] `POST /auth/refresh` â€” RT â†’ ìƒˆ í† í° ìŒ
  - ì™„ë£Œ ê¸°ì¤€: ë§Œë£Œ RT â†’ 401
- [ ] **`requireRole` ë¯¸ë“¤ì›¨ì–´** â€” admin / instructor / member
  - ì™„ë£Œ ê¸°ì¤€: member ê³„ì •ìœ¼ë¡œ admin ë¼ìš°íŠ¸ â†’ 403
- [ ] users í…Œì´ë¸”ì— í…ŒìŠ¤íŠ¸ ê³„ì • 3ê°œ ë°ì´í„° ì‚½ì… (bcrypt í•´ì‹±)

### 9ê°œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì²´í¬
- [ ] ì˜¬ë°”ë¥¸ ìê²©ì¦ëª… â†’ 200 + í† í°
- [ ] ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ â†’ 401
- [ ] ìœ íš¨ í† í°ìœ¼ë¡œ /auth/me â†’ 200
- [ ] ë§Œë£Œ í† í°ìœ¼ë¡œ /auth/me â†’ 401
- [ ] í† í° ì—†ì´ /auth/me â†’ 401
- [ ] ìœ íš¨ RTë¡œ refresh â†’ 200 + ìƒˆ í† í°
- [ ] ë§Œë£Œ RTë¡œ refresh â†’ 401
- [ ] admin í† í°ìœ¼ë¡œ /members â†’ 200
- [ ] member í† í°ìœ¼ë¡œ /members â†’ 403

---

## ğŸ¤– Claude ê°œë°œ ìš”ì²­ ìˆœì„œ

### ìš”ì²­ 1 â€” JWT ì¸ì¦ ë¼ìš°í„° ì „ì²´
```
Fastify JWT ì¸ì¦ ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ì¤˜. src/routes/auth.ts

ì—”ë“œí¬ì¸íŠ¸:
1. POST /auth/login
   - body: { email, password }
   - Supabase users í…Œì´ë¸”ì—ì„œ emailë¡œ ì¡°íšŒ
   - bcrypt.compare(password, user.password_hash)
   - ì„±ê³µ: { accessToken (15ë¶„), refreshToken (7ì¼), user: { id, email, role, name } }
   - ì‹¤íŒ¨: 401 { error: 'INVALID_CREDENTIALS' }

2. POST /auth/logout
   - body: { refreshToken }
   - refresh_tokens í…Œì´ë¸”ì—ì„œ í•´ë‹¹ í† í° ì‚­ì œ (ë¬´íš¨í™”)

3. GET /auth/me
   - Authorization: Bearer {accessToken} í—¤ë” í•„ìˆ˜
   - í† í° ê²€ì¦ â†’ users í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ì ì¡°íšŒ
   - ë°˜í™˜: { id, email, role, name }

4. POST /auth/refresh
   - body: { refreshToken }
   - DBì—ì„œ RT ìœ íš¨ì„± í™•ì¸ â†’ ìƒˆ accessToken + refreshToken ë°œê¸‰
   - ë§Œë£Œ/ì—†ëŠ” RT â†’ 401

í™˜ê²½ë³€ìˆ˜: JWT_SECRET
íŒ¨í‚¤ì§€: @fastify/jwt, bcryptjs
```

### ìš”ì²­ 2 â€” requireRole ë¯¸ë“¤ì›¨ì–´
```
ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ì¤˜. src/middlewares/auth.ts

1. authenticate: Authorization Bearer í† í° ê²€ì¦ â†’ request.userì— ì‚¬ìš©ì ì •ë³´ ì£¼ì…
2. requireRole(...roles: string[]): authenticate í›„ user.roleì´ rolesì— ì—†ìœ¼ë©´ 403

ì‚¬ìš© ì˜ˆì‹œ:
fastify.get('/members', { preHandler: [requireRole('admin')] }, handler)
fastify.get('/my-info', { preHandler: [requireRole('admin', 'instructor', 'member')] }, handler)
```

### ìš”ì²­ 3 â€” í…ŒìŠ¤íŠ¸ ê³„ì • ì‹œë“œ SQL
```
users í…Œì´ë¸”ì— í…ŒìŠ¤íŠ¸ ê³„ì • 3ê°œë¥¼ ì‚½ì…í•˜ëŠ” SQLì„ ì‘ì„±í•´ì¤˜.
ë¹„ë°€ë²ˆí˜¸ 'password123'ì„ bcryptë¡œ í•´ì‹±í•œ ê°’($2b$10$...) í¬í•¨.

INSERT INTO users (email, password_hash, role, name, phone) VALUES
('admin@lifespeech.kr', '{bcrypt_hash}', 'admin', 'ê´€ë¦¬ì', '010-0000-0001'),
('instructor@lifespeech.kr', '{bcrypt_hash}', 'instructor', 'ê°•ì‚¬ í™ê¸¸ë™', '010-0000-0002'),
('member@lifespeech.kr', '{bcrypt_hash}', 'member', 'íšŒì› ê¹€ì² ìˆ˜', '010-0000-0003');

ì‹¤ì œ bcrypt hash ê°’ì„ ì§ì ‘ ê³„ì‚°í•´ì„œ ë„£ì–´ì¤˜.
```

---

## âœ… ì˜¤ëŠ˜ ë‚´ê°€ ì§ì ‘ í™•ì¸í•  ê²ƒ

**Postmanìœ¼ë¡œ 9ê°œ ì‹œë‚˜ë¦¬ì˜¤ ìˆœì„œëŒ€ë¡œ í…ŒìŠ¤íŠ¸**
- [ ] `POST {API}/auth/login` body: `{ "email": "admin@lifespeech.kr", "password": "password123" }` â†’ 200 + accessToken í™•ì¸
- [ ] ê°™ì€ ìš”ì²­ì— `"password": "wrong"` â†’ 401 í™•ì¸
- [ ] `GET {API}/auth/me` Headers: `Authorization: Bearer {ìœ„ì—ì„œë°›ì€í† í°}` â†’ 200 + ì‚¬ìš©ì ì •ë³´ í™•ì¸
- [ ] Authorization í—¤ë” ì—†ì´ `GET {API}/auth/me` â†’ 401 í™•ì¸
- [ ] `POST {API}/auth/refresh` body: `{ "refreshToken": "..." }` â†’ 200 + ìƒˆ í† í° í™•ì¸
- [ ] ê°•ì‚¬ ê³„ì • ë¡œê·¸ì¸ â†’ ê°•ì‚¬ í† í°ìœ¼ë¡œ `GET {API}/members` â†’ 403 í™•ì¸ (admin ì „ìš© ë¼ìš°íŠ¸)
- [ ] ê´€ë¦¬ì ê³„ì • í† í°ìœ¼ë¡œ `GET {API}/members` â†’ 200 í™•ì¸

**âŒ ë§‰í˜”ì„ ë•Œ**
- bcrypt ë¹„êµ ì‹¤íŒ¨ â†’ ì‹œë“œ SQLì˜ hashê°’ì´ ì‹¤ì œ password123ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ì¬í™•ì¸
- JWT_SECRET ì˜¤ë¥˜ â†’ .env íŒŒì¼ í™•ì¸, Railwayì—ë„ ì„¤ì •ëëŠ”ì§€ í™•ì¸

---

## ì‘ì—… ë¡œê·¸

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ë¹„ê³  |
|------|-----------|------|
| 10:00 | | |
| 10:30 | | |
| 11:00 | | |
| 11:30 | | |
| 13:00 | | |
| 13:30 | | |
| 14:00 | | |
| 14:30 | | |
| 15:00 | | |
| 15:30 | | |
| 16:00 | | |
| 17:00 | | |
| 17:30 | | |
| 18:00 | | |
| 18:30 | | |

---

## ë©”ëª¨ / ì´ìŠˆ

-
