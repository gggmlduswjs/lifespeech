---
date: 2026-03-17
week: 4주차
phase: AI 기능 + 이터레이션
tags: [lifespeech, planner, dev, AI]
---

# 2026-03-17 (화) — 4주차 D2

> **근무:** 13:00 ~ 19:00 · 실 작업 **5.5시간** (스피치 준비 0.5h 제외)
> **오전:** 피드백 반영
> **오후:** AI 음성 녹음 + OpenAI Whisper STT 연동

> ⚠️ **짧은 날** — 백엔드 Whisper 연동 + 프론트 녹음 UI까지. 피드백이 많으면 STT만.

---

## 시간 블록

| 시간 | 작업 | 예상 | 완료 기준 |
|------|------|------|-----------|
| 13:00–13:30 | 피드백 반영 + 재배포 | 0.5h | P0/P1 수정 완료 |
| 13:30–15:00 | 백엔드: Whisper STT API 구현 | 1.5h | Postman 음성파일 → 텍스트 반환 |
| 15:00–16:30 | 프론트: MediaRecorder 녹음 컴포넌트 | 1.5h | 녹음 → Blob 생성 |
| 16:30–17:30 | 프론트-백 연동 + UI | 1h | 녹음 → 텍스트 화면에 표시 |
| 17:30–18:30 | 배포 + 테스트 | 1h | 실제 음성 → STT 성공 ✅ |
| 18:30–19:00 | 🎤 스피치 준비 | | |
| 19:30 | 🎤 스피치 수업 | | |

---

## 상세 체크리스트

### 피드백 반영 (13:00)
- [ ] 카카오톡 피드백 확인
- [ ] P0/P1 빠르게 수정 → 재배포

### 백엔드: Whisper STT (13:30)
- [ ] `POST /ai/analyze-speech` 실제 구현
  ```ts
  // multipart/form-data로 audio 파일 수신
  const formData = new FormData()
  formData.append('file', audioBuffer, { filename: 'audio.webm', contentType: 'audio/webm' })
  formData.append('model', 'whisper-1')
  formData.append('language', 'ko')
  const transcription = await openai.audio.transcriptions.create(formData)
  ```
- [ ] 응답: `{ transcription: string, duration: number }`
- [ ] Fastify multipart 플러그인: `@fastify/multipart`
- [ ] Postman: 실제 음성 파일(.webm) → 한국어 텍스트 반환 확인

### 프론트: MediaRecorder 컴포넌트 (15:00)
- [ ] `components/SpeechRecorder.tsx`
  ```tsx
  // MediaRecorder API
  navigator.mediaDevices.getUserMedia({ audio: true })
  const recorder = new MediaRecorder(stream)
  recorder.ondataavailable = (e) => chunks.push(e.data)
  recorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'audio/webm' })
    onRecordingComplete(blob)
  }
  ```
- [ ] 녹음 시작 버튼 (빨간 원) → 중지 버튼
- [ ] 녹음 시간 표시 (타이머)
- [ ] 브라우저 마이크 권한 요청 처리

### 프론트-백 연동 (16:30)
- [ ] `/member/speech-analysis` 페이지 생성
- [ ] `SpeechRecorder` 컴포넌트 삽입
- [ ] 녹음 완료 → `Blob → FormData → POST /ai/analyze-speech`
- [ ] 로딩 상태: "분석 중..." 스피너
- [ ] 결과: 텍스트 transcript 화면에 표시

---

## 🤖 Claude 개발 요청 순서

### 요청 1 — Whisper STT 백엔드 구현
```
POST /ai/analyze-speech 엔드포인트에 OpenAI Whisper STT를 구현해줘.
backend/src/routes/ai.ts 수정.

처리 흐름:
1. @fastify/multipart로 audio 파일 수신 (webm/mp4/wav 허용)
2. 파일 버퍼를 FormData에 담아 Whisper API 호출:
   model: 'whisper-1', language: 'ko'
3. 응답: { transcription: string, duration: number }

오디오 길이(duration)는 파일 크기나 메타데이터로 추정.
에러: 파일 없음 → 400, Whisper 실패 → 502

Postman 테스트: form-data key=audio, 실제 mp3/wav 파일 첨부해서 테스트.
```

### 요청 2 — MediaRecorder 녹음 컴포넌트
```
브라우저 마이크 녹음 컴포넌트를 만들어줘.
components/SpeechRecorder.tsx

기능:
- 녹음 시작 버튼 (빨간 원 아이콘) → 마이크 권한 요청
- 녹음 중: 타이머 표시 (00:00 형식), 중지 버튼
- 녹음 완료 → Blob(audio/webm) 생성 → onRecordingComplete(blob) 콜백

코드 기반:
  navigator.mediaDevices.getUserMedia({ audio: true })
  const recorder = new MediaRecorder(stream)
  recorder.ondataavailable → chunks 수집
  recorder.onstop → Blob 생성

마이크 권한 거부 시 안내 메시지 표시.
```

### 요청 3 — 음성 분석 페이지 연동
```
음성 녹음 → STT 변환 → 텍스트 표시 페이지를 만들어줘.
app/member/speech-analysis/page.tsx

흐름:
1. SpeechRecorder 컴포넌트 삽입
2. 녹음 완료 → Blob → FormData 변환 → POST /ai/analyze-speech 호출
3. 로딩: "분석 중..." 스피너
4. 성공: 변환된 텍스트 (transcription) 화면에 표시
5. 실패: 에러 메시지 토스트

내일 Claude 피드백 카드 추가 예정이므로, 텍스트 결과 영역을 placeholder로 남겨둬.
```

---

## ✅ 오늘 내가 직접 확인할 것 (M5 브라우저 마이크)

**브라우저 마이크 권한**
- [ ] 크롬에서 배포 URL `/member/speech-analysis` 접속
- [ ] 마이크 권한 팝업 → "허용" 클릭
- [ ] 녹음 버튼 클릭 → 빨간 원 + 타이머 작동 확인

**STT 테스트**
- [ ] 30초 정도 말하기 → 중지
- [ ] "분석 중..." 스피너 표시 확인
- [ ] 텍스트 변환 결과 화면에 표시 확인
- [ ] **변환된 텍스트가 실제 말한 내용과 일치하는지** 직접 확인

**Postman으로도 확인**
- [ ] `POST {Railway_URL}/ai/analyze-speech` → form-data → audio 파일 첨부
  → `{ "transcription": "...", "duration": N }` 응답 확인

**OpenAI 대시보드 확인**
- [ ] `platform.openai.com` → Usage → 오늘 Whisper API 사용량 확인
- [ ] 비용: $0.006/분 기준 확인

**❌ 막혔을 때**
- 마이크 권한 팝업 안 뜸 → 크롬 설정 → 개인정보 → 사이트 설정 → 마이크 확인
- STT 결과 한국어 아님 → language: 'ko' 파라미터 설정됐는지 Claude에게 확인 요청
- API 오류 → Network 탭 → 에러 응답 캡처 → Claude에게 전달

---

## 작업 로그

| 시간 | 작업 내용 | 비고 |
|------|-----------|------|
| 13:00 | | |
| 13:30 | | |
| 14:00 | | |
| 14:30 | | |
| 15:00 | | |
| 15:30 | | |
| 16:00 | | |
| 16:30 | | |
| 17:00 | | |
| 17:30 | | |
| 18:00 | | |
| 18:30 | 스피치 준비 | |
| 19:30 | 🎤 스피치 수업 | |

---

## 메모 / 이슈

-
