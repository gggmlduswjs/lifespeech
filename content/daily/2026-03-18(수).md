---
date: 2026-03-18
week: 4주차
phase: AI 기능 + 이터레이션
tags: [lifespeech, planner, dev, AI]
---

# 2026-03-18 (수) — 4주차 D3

> **근무:** 10:00 ~ 19:00 · 실 작업 **8시간**
> **오전:** 피드백 반영
> **오후:** Claude API 스피치 피드백 + 학생 AI 화면 완성

---

## 시간 블록

| 시간 | 작업 | 예상 | 완료 기준 |
|------|------|------|-----------|
| 10:00–10:30 | 피드백 반영 + 재배포 | 0.5h | |
| 10:30–12:00 | 백엔드: Claude 스피치 분석 연동 | 1.5h | JSON 피드백 응답 확인 |
| 12:00–13:00 | 🍽️ 점심 | | |
| 13:00–14:00 | WPM 계산 + DB 저장 | 1h | 분석 이력 저장 |
| 14:00–16:00 | 프론트: 피드백 카드 UI | 2h | 속도 게이지 + 강점 + 개선점 |
| 16:00–17:00 | 분석 이력 목록 화면 | 1h | 이전 분석 결과 열람 |
| 17:00–18:00 | 전체 흐름 테스트 + 배포 | 1h | 녹음→분석→카드 표시 ✅ |
| 18:00–19:00 | 버퍼 | 1h | |

---

## 상세 체크리스트

### 피드백 반영 (10:00)
- [ ] P0/P1 수정 → 재배포

### 백엔드: Claude 스피치 분석 (10:30)
- [ ] `POST /ai/analyze-speech` 에 Claude 호출 추가
  ```ts
  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-6',
    max_tokens: 512,
    messages: [{
      role: 'user',
      content: `스피치 학원 학생 발화입니다. 한국어로 분석해주세요.
  텍스트: "${transcription}"
  발화시간: ${duration}초

  JSON으로만 응답:
  {
    "wpm": 숫자,
    "wpm_evaluation": "느림|적정|빠름",
    "strength": "강점 한 줄",
    "improvements": ["개선점1", "개선점2"]
  }`
    }]
  })
  ```
- [ ] WPM 계산: `(단어 수 / duration) * 60`
- [ ] 응답: `{ transcription, wpm, wpm_evaluation, strength, improvements }`
- [ ] Postman 테스트: 실제 음성 파일 → JSON 피드백 확인

### DB 저장 (13:00)
- [ ] Supabase `speech_analyses` 테이블:
  ```sql
  id, member_id, transcription, wpm, wpm_evaluation,
  strength, improvements(jsonb), duration, created_at
  ```
- [ ] 분석 완료 후 자동 저장

### 프론트: AI 피드백 카드 (14:00)
- [ ] `components/SpeechFeedbackCard.tsx`
  - 속도 게이지: 느림(파랑) / 적정(초록) / 빠름(주황) + WPM 숫자
  - 강점 배지 (초록 배경)
  - 개선 포인트 2개 리스트 (주황 아이콘)
- [ ] 로딩 → 스켈레톤 → 카드 fade-in 애니메이션

### 분석 이력 화면 (16:00)
- [ ] `GET /ai/speech-analyses?member_id=:id`
- [ ] 날짜별 리스트 → 클릭 → 상세 카드 표시
- [ ] 완료 기준: 이전 분석 결과 다시 열람 가능

---

## 🤖 Claude 개발 요청 순서

### 요청 1 — Claude 스피치 분석 백엔드
```
POST /ai/analyze-speech 에 Claude API 피드백 생성을 추가해줘.
backend/src/routes/ai.ts 수정.

Whisper STT 완료 후 이어서:
1. anthropic.messages.create() 호출
2. 프롬프트:
   "스피치 학원 학생 발화입니다. 한국어로 분석해주세요.
   텍스트: {transcription}
   발화시간: {duration}초

   JSON으로만 응답:
   { wpm: 숫자, wpm_evaluation: '느림|적정|빠름', strength: '강점 한 줄', improvements: ['개선1', '개선2'] }"
3. WPM 계산: 단어 수 / duration * 60
4. speech_analyses 테이블에 저장
5. 최종 응답: { transcription, wpm, wpm_evaluation, strength, improvements, duration }

speech_analyses 테이블 DDL도 같이 작성해줘.
```

### 요청 2 — SpeechFeedbackCard UI 컴포넌트
```
AI 스피치 피드백 결과 카드 컴포넌트를 만들어줘.
components/SpeechFeedbackCard.tsx

props: { wpm, wpm_evaluation, strength, improvements: string[] }

UI 구성:
1. 속도 게이지: 느림(파랑) / 적정(초록) / 빠름(주황) + WPM 숫자 크게
2. 강점 배지: 초록 배경 + 체크 아이콘
3. 개선 포인트: 2개 리스트 (주황 화살표 아이콘)

로딩 → 스켈레톤 애니메이션 → 카드 fade-in

app/member/speech-analysis/page.tsx에서 분석 완료 후 이 카드 표시.
```

### 요청 3 — 분석 이력 화면
```
스피치 분석 이력 화면을 만들어줘.
app/member/speech-analyses/page.tsx

- GET /ai/speech-analyses?member_id={내ID} 연동
- 날짜별 분석 결과 리스트
- 리스트 항목: 날짜 · WPM · wpm_evaluation Badge · 강점 요약
- 항목 클릭 → 상세 카드 (SpeechFeedbackCard) 표시 (모달 or 페이지)
```

---

## ✅ 오늘 내가 직접 확인할 것 (M6 AI 피드백 품질)

**전체 흐름 테스트**
- [ ] `/member/speech-analysis` → 1분 스피치 녹음 → "분석 중..." → 피드백 카드 표시 확인

**AI 피드백 품질 직접 평가 (반드시 읽어볼 것)**
- [ ] WPM 숫자가 말이 되는지 확인 (한국어 적정: 130~150 WPM)
- [ ] wpm_evaluation (느림/적정/빠름) 이 WPM과 일치하는지
- [ ] strength (강점) 이 실제 내용과 관련 있는지
- [ ] improvements 2개가 구체적이고 유용한지
- [ ] **피드백이 이상하면**: 프롬프트 수정 요청 → Claude에게 구체적으로 어떻게 이상한지 전달

**분석 이력 확인**
- [ ] 분석 완료 후 `/member/speech-analyses` → 오늘 분석 결과 목록에 있는지 확인
- [ ] Supabase → speech_analyses 테이블 → 데이터 저장 확인

**Anthropic 대시보드 확인**
- [ ] `console.anthropic.com` → API Usage → 오늘 사용량 확인
- [ ] 한 번 분석에 토큰이 얼마나 드는지 확인 (Input + Output)

**❌ 막혔을 때**
- JSON 파싱 오류 → 프롬프트에 "반드시 JSON만 출력, 다른 텍스트 없이" 강조
- 피드백이 영어로 나옴 → system 프롬프트에 "반드시 한국어로만 응답" 명시 요청

---

## 작업 로그

| 시간 | 작업 내용 | 비고 |
|------|-----------|------|
| 10:00 | | |
| 10:30 | | |
| 11:00 | | |
| 11:30 | | |
| 13:00 | | |
| 13:30 | | |
| 14:00 | | |
| 14:30 | | |
| 15:00 | | |
| 15:30 | | |
| 16:00 | | |
| 16:30 | | |
| 17:00 | | |
| 17:30 | | |
| 18:00 | | |
| 18:30 | | |

---

## 메모 / 이슈

-
